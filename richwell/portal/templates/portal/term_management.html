{% extends "portal/base.html" %}

{% block title %}Term Management - Richwell School Portal{% endblock %}

{% block content %}
<div class="max-w-4xl mx-auto space-y-6">

    <!-- Page Header -->
    {% include "components/organisms/page_header.html" with title="Term Management" subtitle="Create and manage academic terms" %}

    <!-- Create/Edit Term Form -->
    <div class="bg-white rounded-lg shadow p-6">
        <h3 class="text-xl font-semibold mb-6">
            {% if term %}Edit Term{% else %}Create New Term{% endif %}
        </h3>

        <form method="post">
            {% csrf_token %}

            <!-- Term Name -->
            <div class="mb-6">
                {% include "components/molecules/form_field.html" with
                    label="Term Name"
                    name="name"
                    id="name"
                    type="text"
                    placeholder="e.g., Fall 2025, Spring 2026"
                    required=True
                    help_text="Enter the term name (e.g., Fall 2025)"
                %}
            </div>

            <!-- Term Dates Grid -->
            <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-6">
                <!-- Start Date -->
                {% include "components/molecules/date_picker.html" with
                    label="Start Date"
                    name="start_date"
                    required=True
                    help_text="First day of classes"
                %}

                <!-- End Date -->
                {% include "components/molecules/date_picker.html" with
                    label="End Date"
                    name="end_date"
                    required=True
                    help_text="Last day of classes"
                %}
            </div>

            <!-- Deadline Dates Grid -->
            <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-6">
                <!-- Add/Drop Deadline -->
                {% include "components/molecules/date_picker.html" with
                    label="Add/Drop Deadline"
                    name="add_drop_deadline"
                    required=True
                    help_text="Last day for students to add or drop courses"
                %}

                <!-- Grade Encoding Deadline -->
                {% include "components/molecules/date_picker.html" with
                    label="Grade Encoding Deadline"
                    name="grade_encoding_deadline"
                    required=True
                    help_text="Last day for professors to submit grades"
                %}
            </div>

            <!-- Enrollment Period -->
            <div class="bg-blue-50 border border-blue-200 rounded-lg p-4 mb-6">
                <h4 class="font-semibold text-blue-900 mb-3">Enrollment Period</h4>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <!-- Enrollment Start -->
                    {% include "components/molecules/date_picker.html" with
                        label="Enrollment Opens"
                        name="enrollment_start"
                        help_text="When students can start enrolling"
                    %}

                    <!-- Enrollment End -->
                    {% include "components/molecules/date_picker.html" with
                        label="Enrollment Closes"
                        name="enrollment_end"
                        help_text="When enrollment period ends"
                    %}
                </div>
            </div>

            <!-- Status Selection -->
            <div class="mb-6">
                <label for="status" class="block text-sm font-medium text-gray-700 mb-2">
                    Status <span class="text-red-500">*</span>
                </label>
                <select
                    id="status"
                    name="status"
                    required
                    class="block w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                >
                    <option value="upcoming">Upcoming</option>
                    <option value="active">Active</option>
                    <option value="completed">Completed</option>
                    <option value="archived">Archived</option>
                </select>
                <p class="mt-2 text-sm text-gray-500">Set the term status</p>
            </div>

            <!-- Is Active Checkbox -->
            <div class="mb-6">
                {% include "components/atoms/checkbox.html" with
                    label="Set as Active Term"
                    name="is_active"
                    id="is_active"
                    description="Mark this as the current active term for enrollment"
                %}
            </div>

            <!-- Submit Buttons -->
            <div class="flex gap-4">
                <button
                    type="submit"
                    class="inline-flex items-center px-6 py-3 border border-transparent text-base font-medium rounded-md shadow-sm text-white bg-blue-600 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500"
                >
                    <svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"/>
                    </svg>
                    {% if term %}Update Term{% else %}Create Term{% endif %}
                </button>

                <a
                    href="{% url 'registrar_dashboard' %}"
                    class="inline-flex items-center px-6 py-3 border border-gray-300 shadow-sm text-base font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500"
                >
                    Cancel
                </a>
            </div>
        </form>
    </div>

    <!-- Existing Terms List -->
    <div class="bg-white rounded-lg shadow p-6" x-data="{ deleteTermId: null, deleteTermName: '' }">
        <h3 class="text-xl font-semibold mb-4">Existing Terms</h3>

        <div class="overflow-x-auto">
            <table class="min-w-full divide-y divide-gray-200">
                <thead class="bg-gray-50">
                    <tr>
                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Term</th>
                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Start Date</th>
                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">End Date</th>
                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Status</th>
                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Actions</th>
                    </tr>
                </thead>
                <tbody class="bg-white divide-y divide-gray-200">
                    <!-- Sample data - replace with actual term data -->
                    <tr>
                        <td class="px-6 py-4 whitespace-nowrap">
                            <div class="font-medium text-gray-900">Fall 2025</div>
                        </td>
                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">Aug 15, 2025</td>
                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">Dec 15, 2025</td>
                        <td class="px-6 py-4 whitespace-nowrap">
                            {% include "components/atoms/badge.html" with text="Active" variant="success" %}
                        </td>
                        <td class="px-6 py-4 whitespace-nowrap text-sm font-medium space-x-3">
                            <a href="#" class="text-blue-600 hover:text-blue-900">Edit</a>
                            <button
                                @click="deleteTermId = 1; deleteTermName = 'Fall 2025'"
                                class="text-red-600 hover:text-red-900"
                            >
                                Delete
                            </button>
                        </td>
                    </tr>
                    <tr>
                        <td class="px-6 py-4 whitespace-nowrap">
                            <div class="font-medium text-gray-900">Spring 2026</div>
                        </td>
                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">Jan 10, 2026</td>
                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">May 15, 2026</td>
                        <td class="px-6 py-4 whitespace-nowrap">
                            {% include "components/atoms/badge.html" with text="Upcoming" variant="info" %}
                        </td>
                        <td class="px-6 py-4 whitespace-nowrap text-sm font-medium space-x-3">
                            <a href="#" class="text-blue-600 hover:text-blue-900">Edit</a>
                            <button
                                @click="deleteTermId = 2; deleteTermName = 'Spring 2026'"
                                class="text-red-600 hover:text-red-900"
                            >
                                Delete
                            </button>
                        </td>
                    </tr>
                </tbody>
            </table>
        </div>

        <!-- Delete Confirmation Modal -->
        <div x-show="deleteTermId !== null" style="display: none;">
            <div
                x-data="{
                    open: deleteTermId !== null,
                    closeModal() {
                        deleteTermId = null;
                        deleteTermName = '';
                    }
                }"
                x-init="$watch('deleteTermId', value => { open = value !== null })"
                @keydown.escape.window="closeModal()"
                x-show="open"
                x-cloak
            >
                <!-- Backdrop -->
                <div
                    x-show="open"
                    x-transition:enter="transition ease-out duration-300"
                    x-transition:enter-start="opacity-0"
                    x-transition:enter-end="opacity-100"
                    x-transition:leave="transition ease-in duration-200"
                    x-transition:leave-start="opacity-100"
                    x-transition:leave-end="opacity-0"
                    @click="closeModal()"
                    class="fixed inset-0 bg-gray-900 bg-opacity-50 z-40"
                ></div>

                <!-- Modal Container -->
                <div class="fixed inset-0 z-50 overflow-y-auto">
                    <div class="flex min-h-full items-center justify-center p-4">
                        <div
                            x-show="open"
                            x-transition:enter="transition ease-out duration-300"
                            x-transition:enter-start="opacity-0 translate-y-4 sm:scale-95"
                            x-transition:enter-end="opacity-100 translate-y-0 sm:scale-100"
                            x-transition:leave="transition ease-in duration-200"
                            x-transition:leave-start="opacity-100 translate-y-0 sm:scale-100"
                            x-transition:leave-end="opacity-0 translate-y-4 sm:scale-95"
                            @click.stop
                            class="relative transform overflow-hidden rounded-lg bg-white text-left shadow-xl transition-all w-full max-w-lg"
                            role="dialog"
                            aria-modal="true"
                        >
                            <!-- Header -->
                            <div class="bg-white px-6 py-4 border-b border-gray-200">
                                <div class="flex items-center justify-between">
                                    <h3 class="text-xl font-semibold text-gray-900">Confirm Delete Term</h3>
                                    <button type="button" @click="closeModal()" class="rounded-md bg-white text-gray-400 hover:text-gray-500">
                                        <svg class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor">
                                            <path stroke-linecap="round" stroke-linejoin="round" d="M6 18L18 6M6 6l12 12" />
                                        </svg>
                                    </button>
                                </div>
                            </div>

                            <!-- Body -->
                            <div class="bg-white px-6 py-4">
                                <div class="flex items-start space-x-3">
                                    <div class="flex-shrink-0">
                                        <svg class="h-6 w-6 text-red-600" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor">
                                            <path stroke-linecap="round" stroke-linejoin="round" d="M12 9v3.75m-9.303 3.376c-.866 1.5.217 3.374 1.948 3.374h14.71c1.73 0 2.813-1.874 1.948-3.374L13.949 3.378c-.866-1.5-3.032-1.5-3.898 0L2.697 16.126zM12 15.75h.007v.008H12v-.008z" />
                                        </svg>
                                    </div>
                                    <div class="flex-1">
                                        <p class="text-sm text-gray-700 mb-2">Are you sure you want to delete this term?</p>
                                        <p class="text-sm font-semibold text-gray-900" x-text="deleteTermName"></p>
                                        <p class="text-sm text-red-600 mt-3">
                                            Warning: This will also delete all associated sections, enrollments, and grades. This action cannot be undone.
                                        </p>
                                    </div>
                                </div>
                            </div>

                            <!-- Footer -->
                            <div class="bg-gray-50 px-6 py-4 flex flex-row-reverse gap-3">
                                <button
                                    type="button"
                                    @click="alert('Delete action for term ' + deleteTermId); closeModal()"
                                    class="inline-flex justify-center rounded-md bg-red-600 px-4 py-2 text-sm font-semibold text-white shadow-sm hover:bg-red-700"
                                >
                                    Yes, Delete Term
                                </button>
                                <button
                                    type="button"
                                    @click="closeModal()"
                                    class="inline-flex justify-center rounded-md bg-white px-4 py-2 text-sm font-semibold text-gray-900 shadow-sm ring-1 ring-inset ring-gray-300 hover:bg-gray-50"
                                >
                                    Cancel
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Info Card -->
    <div class="bg-gray-50 border border-gray-200 rounded-lg p-6">
        <h4 class="font-semibold text-gray-900 mb-3">Term Management Guidelines</h4>
        <ul class="text-sm text-gray-600 space-y-2 list-disc list-inside">
            <li>Start Date must be before End Date</li>
            <li>Add/Drop Deadline should be within the first few weeks of the term</li>
            <li>Grade Encoding Deadline should be after the End Date</li>
            <li>Only one term can be marked as "Active" at a time</li>
            <li>Enrollment period dates are optional but recommended</li>
            <li>Deleting a term will cascade delete all related data</li>
        </ul>
    </div>

</div>
{% endblock %}
